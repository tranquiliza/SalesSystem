@inject IJSRuntime JSRuntime
@inject HttpClient Http
@inject IConfiguration config

<ul id="categoriesDropdown" class="dropdown-content">
    @if (categories == null)
    {
        <ProgressBar></ProgressBar>
    }
    else
    {
        @foreach (var category in categories)
        {
            <li><a href="products/@category">@category</a></li>
        }
    }
</ul>

<ul class="sidenav" id="mobile-menu">
    <li>
        <NavLink class="waves-effect waves-light" href="" Match="NavLinkMatch.All">
            Home
        </NavLink>
    </li>
    <li>
        <NavLink class="waves-effect waves-light" href="about">
            About
        </NavLink>
    </li>
    <li class="no-padding">
        <ul class="collapsible collapsible-accordion">
            <li>
                <NavLink href="products" class="collapsible-header waves-effect waves-light">Products<i class="material-icons">arrow_drop_down</i></NavLink>
                <div class="collapsible-body">
                    <ul>
                        @if (categories == null)
                        {
                            <ProgressBar></ProgressBar>
                        }
                        else
                        {
                            @foreach (var category in categories)
                            {
                                <li><a href="products/@category">@category</a></li>
                            }
                        }
                    </ul>
                </div>
            </li>
        </ul>
    </li>
</ul>
<div class="navbar-fixed">
    <nav>
        <div class="nav-wrapper">
            <a href="" class="brand-logo center"><img src="/images/logo.png" /></a>
            <a href="" data-target="mobile-menu" class="sidenav-trigger"><i class="material-icons">menu</i></a>
            <ul class="left hide-on-med-and-down">
                <li>
                    <NavLink class="waves-effect waves-light" href="" Match="NavLinkMatch.All">
                        Home
                    </NavLink>
                </li>
                <li>
                    <NavLink class="waves-effect waves-light" href="about">
                        About
                    </NavLink>
                </li>
                <li>
                    <NavLink data-target="categoriesDropdown" class="dropdown-trigger waves-effect waves-light" href="products">
                        Products<i class="material-icons right">arrow_drop_down</i>
                    </NavLink>
                </li>
            </ul>

            <ul class="right">
                <li>
                    <NavLink class="waves-effect waves-light" href="basket">
                        <MenuBasket></MenuBasket>
                    </NavLink>
                </li>
            </ul>
        </div>
    </nav>
</div>

@code {
    private string[] categories;

    protected override async Task OnInitializedAsync()
    {
        categories = await Http.GetJsonAsync<string[]>(config.ApiBaseAddress + "products/categories");
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JSRuntime.InvokeVoidAsync("InitializeDropDowns").ConfigureAwait(false);
            await JSRuntime.InvokeVoidAsync("InitializeSideNav").ConfigureAwait(false);
            await JSRuntime.InvokeVoidAsync("InitializeCollapsibles").ConfigureAwait(false);
        }

        await base.OnAfterRenderAsync(firstRender);
    }
}
